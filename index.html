<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Espina Sound Lab</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap');
    @font-face { font-family: 'Nultien-Regular'; src: url('fonts/Nultien-Regular.otf'); font-display: swap; }
    @font-face { font-family: 'Euro'; src: url('fonts/EurostileExt-Med.otf'); font-display: swap; }
    @font-face { font-family: 'Utara'; src: url('fonts/Utara-Regular.woff2'); font-display: swap; }
    @font-face { font-family: 'steps'; src: url('fonts/Steps-Mono-Thin.otf'); font-display: swap; }
    @font-face { font-family: 'pilcrow'; src: url('fonts/PilcrowRounded-Regular.woff'); font-display: swap; }
    @font-face { font-family: 'pilcrowm'; src: url('fonts/PilcrowRounded-Medium.woff'); font-display: swap; }
    @font-face { font-family: 'supreme'; src: url('fonts/Supreme-Regular.woff'); font-display: swap; }
    @font-face { font-family: 'switzer'; src: url('fonts/Switzer-Regular.woff'); font-display: swap; }

    :root {
      --c-bg: #000; --c-fg: #fff; --c-accent: #0ff; --c-accent-hover: #33ffff;
      --c-muted: rgba(255,255,255,0.976);
      --shadow-strong: 0 0 30px rgba(0,0,0,0.4); --shadow-accent: 0 0 15px var(--c-accent);
      --border-1: 1px solid var(--c-accent); --border-2: 2px solid var(--c-accent);
      --space-1: 5px; --space-2: 10px; --space-3: 12px; --space-4: 15px;
      --radius-1: 6px; --font-ui: "Silkscreen", Courier, monospace;
      --transition-fast: 0.2s ease; --transition-med: 0.4s ease;

      /* Will be set by JS to the widest button width */
      --menu-button-width: auto;
    }

    body {
      font-family: var(--font-ui); font-size: 16px; color: var(--c-fg);
      background: var(--c-bg) url('logo f5.png') no-repeat center 45%;
      background-size: 80% auto; background-attachment: fixed;
      margin: 0; padding: var(--space-4); line-height: 1.7;
      max-width: 90%; position: relative; min-height: 100vh;
    }
    body::after { content: ""; position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: -1; }

    h1 { font-size: 0; margin: 0 0 var(--space-1) 0; text-align: left; }
    h1 img { display: block; max-width: 350px; width: 100%; height: auto; }
    a { color: var(--c-fg); text-decoration: none; }

    .bg-logo {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 60%; height: auto; background: url('logo.png') no-repeat center/contain;
      opacity: .2; z-index: -1; animation: pulseBg 3s ease-in-out infinite;
    }
    @keyframes pulseBg { 0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.2}50%{transform:translate(-50%,-50%) scale(1.05);opacity:.3} }

    .tagline { display: inline-block; font-size: 1em; color: var(--c-muted); margin: 10px 0 30px .4%; text-align: left; }

    #topSubmitBtn {
      position: fixed; top: 40px; right: 20px; padding: 10px 18px; background: var(--c-accent);
      color: #000; border: var(--border-2); font-family: var(--font-ui); cursor: pointer; z-index: 200; font-size: 1em; font-weight: 400;
      transition: transform .15s ease, background var(--transition-slow), color var(--transition-slow);
    }
    #topSubmitBtn:hover { background: var(--c-accent-hover); }
    #topSubmitBtn:active { transform: scale(0.92); }

    /* ===========================
       LEFT-PINNED MENU, BUTTON BOX
       =========================== */
    .menu { display: block; }

    .menu-item {
      display: block;
      overflow: hidden;
      margin: var(--space-1) 0;
      width: var(--menu-button-width);
      max-width: 100%;
    }

    .menu .menu-item > a {
      position: relative;
      display: block;
      width: 100%;
      box-sizing: border-box;
      text-transform: uppercase;
      padding: var(--space-1) 20px;
      color: var(--c-fg);
      font-family: var(--font-ui);
      font-size: 1em;
      font-weight: 600;
      transition: color var(--transition-fast), text-shadow var(--transition-fast), transform 0.15s ease;
      z-index: 0;
    }

    .menu .menu-item > a::before,
    .menu .menu-item > a::after {
      content: '';
      position: absolute;
      left: 0; width: 100%; height: 100%;
      opacity: 0;
      transition: transform var(--transition-med), opacity var(--transition-med);
      pointer-events: none;
    }
    .menu .menu-item > a::before {
      top: 0;
      border-top: 2px solid var(--c-accent);
      border-bottom: 2px solid var(--c-accent);
      transform: scaleY(2);
      transform-origin: center top;
    }
    .menu .menu-item > a::after {
      top: 2px;
      background-color: var(--c-accent);
      transform: scale(0);
      transform-origin: center center;
      z-index: -1;
    }
    .menu .menu-item > a:hover {
      color: #000;
      animation: glitchFlicker .3s steps(2) 1;
      text-shadow: 0 0 1px var(--c-accent), 0 0 12px var(--c-accent);
    }
    .menu .menu-item > a:hover::before { transform: scaleY(1); opacity: 1; }
    .menu .menu-item > a:hover::after  { transform: scale(1);  opacity: 1; }

    @keyframes glitchFlicker { 0%{transform:translateX(0)}50%{transform:translateX(1px)}100%{transform:translateX(0)} }

    /* Accordion content panels (unchanged visuals/behavior) */
    .content-section {
      display: none;
      margin: 0 0 var(--space-3) 0;
      padding: 15px 25px 15px 12px;
      border-left: 4px solid var(--c-accent);
      border-right: 8px solid var(--c-accent);
      background: rgba(0, 0, 0, 0.2);
      width: 100vw;             /* NOTE: retained, per current site; see critique to consider 100% */
      max-width: none; box-sizing: border-box;
    }
    .content-section p { margin: 0px 0; }
    #section-studio img { display: block; margin: 20px auto; }
    .content-section {
      font-family: 'pilcrowm', Arial, sans-serif;
      font-size: 1.2em;
      line-height: 1.5;
      text-align: justify;
    }

    .studio-image {
      width: 100%; max-width: 500px; height: auto; display: block;
      margin: 20px auto; border-radius: var(--radius-1); box-shadow: var(--shadow-strong);
    }

    footer {
      position: fixed; bottom: 0; left: 0; width: 100%; text-align: center;
      padding: 10px 0; background: rgba(0,0,0,0.7); color: var(--c-fg);
      font-family: var(--font-ui); z-index: -1;
      font-size: 0.8em;
    }

    /* Modal */
    #submitDialog {
      display: none; position: fixed; inset: 0; width: 100vw; height: 100vh;
      justify-content: center; align-items: center; background: rgba(0,0,0,0.6); z-index: 100;
    }
    #submitDialog form {
      background: var(--c-bg); color: var(--c-fg); border: var(--border-2);
      padding: 20px; max-width: 400px; width: 90vw; font-family: var(--font-ui);
      box-shadow: var(--shadow-accent); text-align: left; max-height: 90vh; overflow-y: auto;
      box-sizing: border-box; border-radius: var(--radius-1);
    }
    #submitDialog.show + #topSubmitBtn,
    #submitDialog.show ~ #topSubmitBtn { display: none; }
    #submitDialog input, #submitDialog textarea {
      width: 100%; padding: 8px; margin: 5px 0 15px 0; background: var(--c-bg);
      border: var(--border-1); color: var(--c-fg); font-family: var(--font-ui); box-sizing: border-box;
    }
    #submitDialog input::placeholder, #submitDialog textarea::placeholder { color: #aaa; opacity: 0.7; }
    #submitDialog button {
      margin-right: 10px; padding: 8px 15px; background: var(--c-accent);
      border: none; color: #000; cursor: pointer; font-family: var(--font-ui);
      font-size: 1em; transition: background var(--transition-fast), color var(--transition-fast);
    }
    #submitDialog button:hover { background: var(--c-accent-hover); }
    #submitDialog .two-fields { display: flex; gap: 10px; margin-bottom: 15px; }
    #submitDialog .two-fields > div { flex: 1; }

    /* ========= Testimonials Slider Styles (ADDED) ========= */
    /* Designed to match cyber-minimal neon/mono vibe; uses site variables */
    .testimonial-slider {
      position: relative;
      border-left: var(--border-2);
      border-right: var(--border-2);
      background: rgba(0,0,0,0.35);
      box-shadow: 0 0 0 1px rgba(0,255,255,0.15), var(--shadow-strong);
      border-radius: var(--radius-1);
      padding: 16px 48px; /* inner space around track, leaves room for arrows */
      overflow: hidden;
      isolation: isolate; /* keep glow layers beneath content */
    }

    /* subtle animated border glow */
    .testimonial-slider::before {
      content: "";
      position: absolute; inset: 0;
      border: 1px solid rgba(0,255,255,0.25);
      border-radius: var(--radius-1);
      box-shadow: 0 0 22px rgba(0,255,255,0.15);
      pointer-events: none;
      opacity: 0.75;
      transition: opacity var(--transition-med);
    }
    .testimonial-slider:hover::before { opacity: 1; }

    .slider-viewport {
      overflow: hidden;
      width: 100%;
    }
    .slider-track {
      display: flex;
      gap: 12px;
      will-change: transform;
      transform: translate3d(0,0,0);
      transition: transform 500ms cubic-bezier(.2,.7,.2,1);
    }
    .slide {
      flex: 0 0 85%; /* mobile default shows single card with peeking */
      max-width: 700px;
      margin: 8px auto;
      background: rgba(0,0,0,0.4);
      border: var(--border-1);
      border-radius: var(--radius-1);
      padding: 16px 16px;
      box-shadow: 0 0 10px rgba(0,255,255,0.08);
      color: var(--c-fg);
      position: relative;
    }
    .slide::after {
      /* subtle neon divider accent bottom */
      content: "";
      position: absolute; left: 0; right: 0; bottom: 0;
      height: 2px; background: linear-gradient(90deg, transparent, var(--c-accent), transparent);
      opacity: .6;
    }
    .slide-quote {
      font-family: 'pilcrowm', Arial, sans-serif;
      font-size: 1.05em;
      line-height: 1.6;
      letter-spacing: .2px;
      text-align: left; /* maintain readability */
    }
    .slide-meta {
      margin-top: 8px;
      font-size: .9em;
      color: var(--c-muted);
      display: flex;
      align-items: center;
      gap: 8px;
      opacity: .85;
    }
    .slide-meta .dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--c-accent);
      box-shadow: 0 0 6px var(--c-accent);
      flex: 0 0 6px;
    }

    /* arrows match menu hover aesthetic */
    .slider-arrow {
      position: absolute; top: 50%;
      transform: translateY(-50%);
      width: 38px; height: 38px;
      display: grid; place-items: center;
      border: var(--border-2);
      background: rgba(0,0,0,0.5);
      color: var(--c-fg);
      cursor: pointer;
      transition: transform .15s ease, background var(--transition-med), color var(--transition-med);
      z-index: 2;
      user-select: none;
    }
    .slider-arrow:hover {
      background: var(--c-accent);
      color: #000;
      text-shadow: 0 0 1px var(--c-accent), 0 0 12px var(--c-accent);
      animation: glitchFlicker .3s steps(2) 1; /* reuse site micro-glitch */
    }
    .slider-arrow:active { transform: translateY(-50%) scale(0.94); }
    .slider-arrow.left { left: 6px; }
    .slider-arrow.right { right: 6px; }

    /* pagination dots (optional visual hint, keyboard focusable) */
    .slider-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
    }
    .slider-dot {
      width: 8px; height: 8px; 
      border: 1px solid var(--c-accent);
      background: transparent;
      box-shadow: 0 0 8px rgba(0,255,255,0.2);
      opacity: .7;
      transition: opacity var(--transition-fast), background var(--transition-fast);
    }
    .slider-dot[aria-current="true"] {
      background: var(--c-accent);
      opacity: 1;
    }

    /* reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .slider-track { transition: none; }
      .testimonial-slider::before { animation: none; }
      .slider-arrow:hover { animation: none; }
    }

    /* responsive tweaks */
    @media (min-width: 760px) {
      .slide { flex-basis: 60%; }
    }
    @media (min-width: 1024px) {
      .slide { flex-basis: 45%; }
    }

    /* Mobile guards */
    @media (max-width: 600px) {
      body { padding: 40px 15px; }
      body::after { background: rgba(0,0,0,0.5); }
      h1 img { max-width: 200px; }
      .menu .menu-item > a { white-space: normal; text-align: left; }
      #topSubmitBtn {
        top: 12px; right: 12px; padding: 6px 12px; font-size: .8em; border-width: 2px; transform: scale(.9);
      }
      .slider-arrow { width: 34px; height: 34px; }
    }
  </style>
</head>
<body>
  <div class="bg-logo" aria-hidden="true"></div>
  <h1><img src="wordmark.png" alt="Espina Sound Lab" /></h1>
  <button id="topSubmitBtn" aria-haspopup="dialog" aria-controls="submitDialog">Submit Your Music</button>
  <p class="tagline">Mixing and Mastering Studio</p>

  <!-- LEFT-PINNED MENU: same structure, each link wrapped in .menu-item -->
  <nav class="menu" aria-label="Primary">
    <div class="menu-item"><a href="#" data-section="about">About</a></div>
    <div id="section-about" class="content-section" role="region" aria-live="polite"></div>

    <div class="menu-item"><a href="#" data-section="studio">The Studio</a></div>
    <div id="section-studio" class="content-section" role="region" aria-live="polite"></div>

    <div class="menu-item"><a href="#" data-section="services">Services</a></div>
    <div id="section-services" class="content-section" role="region" aria-live="polite"></div>

    <div class="menu-item"><a href="#" data-section="faq">FAQ / Workflow</a></div>
    <div id="section-faq" class="content-section" role="region" aria-live="polite"></div>

    <div class="menu-item"><a href="#" data-section="portfolio">Portfolio</a></div>
    <div id="section-portfolio" class="content-section" role="region" aria-live="polite"></div>

    <div class="menu-item"><a href="#" data-section="testimonials">Testimonials</a></div>
    <!-- Testimonials section container. Slider is injected when opened -->
    <div id="section-testimonials" class="content-section" role="region" aria-live="polite"></div>

    <div class="menu-item"><a href="#" id="submitBtn">Submit Your Music</a></div>
    <div class="menu-item"><a href="mailto:hello@espinasoundlab.xyz">Contact</a></div>
  </nav>

  <footer>¬© Espina Sound Lab üìç Kreuzberg, Berlin</footer>

  <!-- Submit Track Dialog -->
  <div id="submitDialog" role="dialog" aria-modal="true" aria-label="Track submission">
    <form id="trackForm" action="https://formspree.io/f/mvgveynq" method="POST" target="_blank">
      <h2 id="submit-heading">Track Submission</h2>
      <p>Send your project details and a transfer link. We‚Äôll get back within 1‚Äì2 business days.</p>

      <label for="name">Full Name:</label>
      <input type="text" id="name" name="name" required />

      <label for="address">Address:</label>
      <input type="text" id="address" name="address" required />

      <div class="two-fields">
        <div>
          <label for="city">City:</label>
          <input type="text" id="city" name="city" required />
        </div>
        <div>
          <label for="zip">ZIP Code:</label>
          <input type="text" id="zip" name="zip" required />
        </div>
      </div>

      <div class="two-fields">
        <div>
          <label for="country">Country:</label>
          <input type="text" id="country" name="country" required />
        </div>
        <div>
          <label for="vat">VAT Number:</label>
          <input type="text" id="vat" name="vat" />
        </div>
      </div>

      <label for="tracklink">Track Link:</label>
      <input type="url" id="tracklink" name="tracklink" placeholder="WeTransfer / SwissTransfer" required />

      <label for="notes">Additional Notes:</label>
      <textarea id="notes" name="notes" rows="4" placeholder="Mix references, goals, deadlines‚Ä¶"></textarea>

      <button type="submit">Submit</button>
      <button type="button" id="closeDialog">Cancel</button>
    </form>
  </div>

  <script>
    // =========================
    // MENU WIDTH NORMALIZATION
    // =========================
    function normalizeMenuWidths() {
      const items = Array.from(document.querySelectorAll('.menu .menu-item > a'));
      if (!items.length) return;

      document.documentElement.style.removeProperty('--menu-button-width');

      items.forEach(a => {
        a.style.width = 'auto';
        a.style.display = 'inline-block';
      });

      const max = Math.ceil(
        Math.max(...items.map(a => a.getBoundingClientRect().width))
      );

      items.forEach(a => { a.style.display = 'block'; });

      document.documentElement.style.setProperty('--menu-button-width', max + 'px');
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', normalizeMenuWidths);
    } else {
      normalizeMenuWidths();
    }
    window.addEventListener('load', normalizeMenuWidths);
    let _mwTO;
    window.addEventListener('resize', () => {
      clearTimeout(_mwTO);
      _mwTO = setTimeout(normalizeMenuWidths, 150);
    });

    // =========================
    // ACCORDION + MODAL LOGIC
    // =========================
    (function(){
      const submitDialog   = document.getElementById("submitDialog");
      const trackForm      = document.getElementById("trackForm");
      const closeBtn       = document.getElementById("closeDialog");
      const submitBtn      = document.getElementById("submitBtn");
      const topSubmitBtn   = document.getElementById("topSubmitBtn");

      function toggleModal(show) {
        submitDialog.style.display = show ? "flex" : "none";
        submitDialog.classList.toggle("show", show);
        if (topSubmitBtn) topSubmitBtn.style.display = show ? "none" : "block";
        if (submitBtn)    submitBtn.style.display    = show ? "none" : "block";
      }
      function openPopup() {
        toggleModal(true);
        const first = submitDialog.querySelector("input, textarea, button");
        if (first) first.focus();
      }
      function closePopup() { toggleModal(false); }

      [submitBtn, topSubmitBtn].forEach(btn => {
        if (btn) btn.addEventListener("click", e => { e.preventDefault(); openPopup(); });
      });
      if (closeBtn) closeBtn.addEventListener("click", closePopup);
      document.addEventListener("keydown", e => { if (e.key === "Escape") closePopup(); });
      submitDialog.addEventListener("click", e => { if (!e.target.closest("form")) closePopup(); });
      trackForm.addEventListener("submit", () => {
        setTimeout(() => { closePopup(); alert("‚úÖ Track submitted!"); }, 500);
      });
    })();

    // =========================
    // SECTION CONTENT
    // =========================
    const sectionContent = {
      about: [
        "Espina Sound Lab is where sonic identity is crafted.",
        "Focused on clean, powerful low end and spacious detail.",
        "Hybrid workflow for max creativity + precision."
      ],
      studio: [
        "Located in the heart of Berlin, Espina Sound Lab operates from a professionally optimised room with almost perfect representation of the full audio spectrum. Powered by Kii Audio Three‚Äôs together with the BXT extensions offering one of the most advanced and accurate sonic experiences to help deliver the best results possible. The studio is completed with Merging Anubis and HAPI converters for high end DA and AD conversion. We work with a hybrid approach, combining the best of both analog and digital worlds. Our most beloved tools are Terry CEQ, DMG suite, Tone Projects, FabFilter‚Ä¶",
        `<img src="images/studiopictest.webp" alt="Espina Sound Lab Studio" class="studio-image">`
      ],
      services: [
        "Mixing & mastering for artists + labels.",
        "Stem mastering & vocal production polishing.",
        "Creative FX, analog saturation, restoration."
      ],
      faq: [
        "Typical turnaround: 2‚Äì4 business days.",
        "Revisions included ‚Äî your satisfaction matters.",
        "Uploads via secure transfer link."
      ],
      portfolio: [
        "Examples coming soon.",
        "Before/after shootouts with A/B player.",
        "Selected releases & credits."
      ],
      /* testimonials content is now created by buildTestimonialsMarkup() on demand */
      testimonials: []
    };

    // =========================
    // Testimonials Slider (ADDED)
    // - Vanilla JS slider built to match your style
    // - Auto-initializes ONLY when Testimonials section is opened
    // =========================

    // Source data (you can edit/expand these safely)
    const testimonialsData = [
      {
        quote: "‚ÄúMy mix never sounded this wide. Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.Translation to club systems is finally on point.‚Äù",
        author: "A. Rivera ‚Äî Producer, Berlin"
      },
      {
        quote: "‚ÄúClean loudness with no fatigue. The low end sits perfectly without smearing the mids.‚Äù",
        author: "M. Klein ‚Äî Label A&R, Hamburg"
      },
      {
        quote: "‚ÄúProfessional, fast, and musical. Subtle moves that made a huge difference.‚Äù",
        author: "J. Park ‚Äî Artist, Seoul"
      },
      {
        quote: "‚ÄúThe hybrid chain gave our EP a polished, modern edge without losing character.‚Äù",
        author: "Nightgrid ‚Äî Indie Label"
      }
    ];

    function buildTestimonialsMarkup() {
      // Construct slider markup using site classes and variables
      return `
        <h2 style="margin: 0 0 10px 0; font-family: var(--font-ui);font-size: 0.8em;text-align: center ;font-weight: normal;letter-spacing: .5px;">What artists say</h2>
        <div class="testimonial-slider" role="group" aria-roledescription="carousel" aria-label="Testimonials">
          <button class="slider-arrow left" aria-label="Previous testimonial" type="button">&#9664;</button>
          <div class="slider-viewport">
            <div class="slider-track">
              ${testimonialsData.map(t => `
                <article class="slide" aria-label="Testimonial">
                  <p class="slide-quote">${t.quote}</p>
                  <div class="slide-meta"><span class="dot" aria-hidden="true"></span><span>${t.author}</span></div>
                </article>
              `).join('')}
            </div>
          </div>
          <button class="slider-arrow right" aria-label="Next testimonial" type="button">&#9654;</button>
        </div>
        <div class="slider-dots" role="tablist" aria-label="Testimonials pagination">
          ${testimonialsData.map((_, i) => `<button class="slider-dot" role="tab" aria-selected="${i===0?'true':'false'}" aria-current="${i===0?'true':'false'}" aria-label="Go to slide ${i+1}" data-index="${i}" type="button"></button>`).join('')}
        </div>
      `;
    }

    // Basic slider controller
    function initTestimonialsSlider(root) {
      if (!root) return;
      const viewport = root.querySelector('.slider-viewport');
      const track = root.querySelector('.slider-track');
      const slides = Array.from(root.querySelectorAll('.slide'));
      const prevBtn = root.querySelector('.slider-arrow.left');
      const nextBtn = root.querySelector('.slider-arrow.right');
      const dotsWrap = root.parentElement.querySelector('.slider-dots');
      const dots = Array.from(dotsWrap.querySelectorAll('.slider-dot'));

      let index = 0;
      let autoTimer = null;
      const AUTO_MS = 4500; // auto-slide interval
      const TRANSITION_MS = 500; // keep in sync with CSS

      function update() {
        const viewportWidth = viewport.clientWidth;
        const gap = 12; // same as CSS gap on .slider-track
        // Compute slide width based on first slide‚Äôs computed width to align translate
        const slideWidth = slides[0].getBoundingClientRect().width;
        const offset = index * (slideWidth + gap);
        track.style.transform = `translate3d(${-offset}px, 0, 0)`;

        dots.forEach((d, i) => {
          const current = i === index;
          d.setAttribute('aria-current', current ? 'true' : 'false');
          d.setAttribute('aria-selected', current ? 'true' : 'false');
        });
      }

      function next() {
        index = (index + 1) % slides.length;
        update();
      }
      function prev() {
        index = (index - 1 + slides.length) % slides.length;
        update();
      }
      function goTo(i) {
        index = Math.max(0, Math.min(slides.length - 1, i));
        update();
      }

      function startAuto() {
        stopAuto();
        autoTimer = setInterval(next, AUTO_MS);
      }
      function stopAuto() {
        if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
      }

      // Events
      nextBtn.addEventListener('click', () => { next(); startAuto(); });
      prevBtn.addEventListener('click', () => { prev(); startAuto(); });

      dots.forEach(d => {
        d.addEventListener('click', () => {
          const i = parseInt(d.getAttribute('data-index'), 10);
          goTo(i);
          startAuto();
        });
      });

      // Pause on hover/focus to respect user control
      root.addEventListener('mouseenter', stopAuto);
      root.addEventListener('mouseleave', startAuto);
      root.addEventListener('focusin', stopAuto);
      root.addEventListener('focusout', startAuto);

      // Simple swipe support
      let startX = 0; let dx = 0; let swiping = false;
      viewport.addEventListener('pointerdown', (e) => { swiping = true; startX = e.clientX; dx = 0; viewport.setPointerCapture(e.pointerId); stopAuto(); });
      viewport.addEventListener('pointermove', (e) => {
        if (!swiping) return;
        dx = e.clientX - startX;
        // apply small drag for affordance
        track.style.transition = 'none';
        track.style.transform = `translate3d(calc(${-index * (slides[0].getBoundingClientRect().width + 12)}px + ${dx}px),0,0)`;
      });
      function endSwipe() {
        if (!swiping) return;
        track.style.transition = ''; // restore
        if (Math.abs(dx) > 40) { dx < 0 ? next() : prev(); } else { update(); }
        swiping = false; dx = 0; startAuto();
      }
      viewport.addEventListener('pointerup', endSwipe);
      viewport.addEventListener('pointercancel', endSwipe);
      viewport.addEventListener('pointerleave', endSwipe);

      // Recalc on resize
      window.addEventListener('resize', () => {
        // Wait for layout to settle
        setTimeout(update, 50);
      });

      // Initial draw
      update();
      startAuto();

      // Expose a destroy method if needed later
      return { destroy: () => { stopAuto(); } };
    }

    // Keep a flag so we only build once
    let testimonialsInitialized = false;

    // =========================
    // Accordion toggle (UNCHANGED LOGIC) + injection of testimonials
    // =========================
    document.querySelectorAll('.menu a[data-section]').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const sec = link.dataset.section;
        const target = document.getElementById("section-" + sec);
        const isVisible = target.style.display === "block";

        // Hide all sections
        document.querySelectorAll('.content-section').forEach(s => s.style.display = "none");

        // Show the clicked one if it was hidden
        if (!isVisible) {
          if (sec === 'testimonials') {
            // Inject slider markup only when Testimonials is opened (ADDED)
            const html = buildTestimonialsMarkup();
            target.innerHTML = html;
            target.style.display = "block";

            // Initialize slider on the injected markup
            const sliderRoot = target.querySelector('.testimonial-slider');
            initTestimonialsSlider(sliderRoot);
          } else {
            // Default behavior for other sections
            // If we had template arrays, render them
            const content = sectionContent[sec] && sectionContent[sec].length
              ? sectionContent[sec]
              : [];
            target.innerHTML = content.map(item => item.startsWith("<img") ? item : `<p>${item}</p>`).join("");
            target.style.display = "block";
          }
        }
      });
    });
  </script>
</body>
</html>






